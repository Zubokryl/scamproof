# Семантический (контекстный) поиск

## Проблема
Умный поиск не находит соответствующие статьи по запросам, например: "врач назначил несколько процедур - сомневаюсь, нужны ли они мне" или "врач процедуры"

## Решение: Семантический поиск

Реализован **семантический (контекстный) поиск**, который понимает смысл запросов, а не просто ищет по ключевым словам.

### Как это работает:

1. **Извлечение семантических терминов** - система анализирует запрос и извлекает ключевые понятия
2. **Расширение запросов синонимами** - использует словарь синонимов для поиска связанных терминов
3. **Понимание контекста** - распознает паттерны запросов (например, "врач + процедуры" = медицинские услуги)
4. **Умное ранжирование** - результаты сортируются по релевантности с учетом семантического соответствия

### Примеры работы:

- Запрос: **"врач процедуры"** → найдет статьи про медицинские процедуры, врачей, лечение
- Запрос: **"сомневаюсь нужны ли процедуры"** → найдет статьи про сомнения в необходимости лечения
- Запрос: **"мошенничество в медицине"** → найдет статьи про медицинские аферы, обман в здравоохранении

## Настройка

### 1. Убедитесь, что Meilisearch запущен
```bash
# Проверьте, что Meilisearch работает на порту 7700
# Если нет, запустите его:
.\meilisearch.exe --master-key=masterKey
```

### 2. Настройте Meilisearch для умного поиска
```bash
cd backend
php artisan search:configure
```

Эта команда настроит:
- Searchable attributes (какие поля искать)
- Ranking rules (правила ранжирования результатов)
- Typo tolerance (допуск опечаток)
- Другие параметры для улучшения поиска

### 3. Импортируйте данные в Meilisearch
```bash
cd backend
php artisan search:import
```

Эта команда:
 - Автоматически настроит индексы после импорта

### 4. Проверьте поиск
Попробуйте снова выполнить поиск по запросу: "врач назначил несколько процедур - сомневаюсь, нужны ли они мне"

## Что было исправлено

1. **Создана команда `search:configure`** - настраивает Meilisearch для умного поиска:
   - Правильный порядок searchable attributes (title, content, category)
   - Оптимизированные ranking rules для лучшей релевантности
   - Настроенный typo tolerance для поиска с опечатками

2. **Создан SemanticSearchService** - сервис для семантического поиска:
   - **Извлечение семантических терминов** - понимает контекст запроса
   - **Словарь синонимов** - расширяет запросы связанными терминами (врач = доктор, медик, специалист)
   - **Распознавание паттернов** - понимает типичные запросы пользователей
   - **Умное ранжирование** - сортирует результаты по релевантности с учетом семантики
   - **Множественный поиск** - ищет по оригинальному запросу, синонимам и семантическим терминам

3. **Улучшен SearchController** - теперь использует SemanticSearchService для контекстного поиска

4. **Обновлена команда `search:import`** - теперь автоматически настраивает индексы после импорта

## Особенности семантического поиска

### Словарь синонимов
Система автоматически расширяет запросы синонимами:
- **врач** → доктор, медик, специалист, терапевт
- **процедуры** → лечение, манипуляции, терапия, обследование
- **сомневаюсь** → не уверен, сомнения, подозреваю
- **мошенничество** → обман, афера, надувательство

### Понимание контекста
Система распознает типичные паттерны запросов:
- "врач + процедуры" → медицинские услуги, лечение
- "сомневаюсь + процедуры" → сомнения в необходимости лечения
- "мошенничество + медицина" → медицинские аферы

### Ранжирование результатов
Результаты сортируются по релевантности:
- Точное совпадение фразы в заголовке (высший приоритет)
- Точное совпадение в содержании
- Совпадение семантических терминов
- Близость ключевых слов друг к другу

## Примечания

- После изменения статей в базе данных, запустите `php artisan search:import` для обновления индекса
- Семантический поиск работает автоматически - просто используйте обычный поиск
- Система понимает смысл запросов, даже если точные слова не совпадают
- Можно расширить словарь синонимов в `app/Services/SemanticSearchService.php`

